---
title: "Datos drogadicción IMIM"
output: html_notebook
---

* Cargamos los datos del estudio a partir de archivos csv y comprobamos que la importación se ha realizado correctamente.

```{r}
Cannabis <- read.csv('Cannabis.csv')
XTC <- read.csv('XTC.csv')
Controles <- read.csv('Controles.csv')
```
```{r}
head(Cannabis, 3)
```

```{r}
head(XTC, 3)
```

```{r}
head(Controles, 3)
```

* Antes de nada, observemos que el los datos procedentes del grupo de estudio del éxtasis tienen una columna extra llamada 'id' que no aporta información. La eliminaremos.

```{r}
XTC$id <- NULL
```


* Añadimos a cada data.frame una variable extra que nos indique la procedencia de los datos antes de juntarlos. ESTA VARIABLE DEBERÁ SER UN FACTOR CON EL GRUPO
DEL ÉXTASIS COMO REFERENCIA.

```{r}
Cannabis$Group <- 'Cannabis'
XTC$Group <- 'XTC'
Controles$Group <- 'Control'
```


* Ahora fusionaremos los datos en un único data.frame. Lo haremos en dos pasos.

```{r}
temporal <- rbind.data.frame(XTC, Cannabis)
Datos <- rbind(temporal, Controles)
head(Datos)
```

```{r}
Datos$Group <- as.factor(Datos$Group)
class(Datos$Group)
```

* Ordenamos el data.frame por el grupo de estudio y el identidicafor de voluntario.

```{r}
library(dplyr)
arrange(Datos, Group, vol) 
```

***
* ¿Cuántos casos (filas) tiene el data.frame enteros y cuántos si se descartan aquellos con algún dato perdido?

```{r}
summary(Datos)
```

```{r}
length(Datos$vol)
```

```{r}

```
***

* Convertimos la variable género en un factor cuyos valores son 'Male' (sex == 1) o 'Female' (sex == 2)

```{r}
Datos$sex[which(Datos$sex == 1)] <- 'Male'
Datos$sex[which(Datos$sex == 2)] <- 'Female'
head(Datos)
Datos$sex <- as.factor(Datos$sex)
```

* Usamos la función 'cut' para crear una nueva variable categórica que contenga la edad de los voluntarios: <= 21, 22 - 24, >= 25 AÑOS

```{r}
Datos$intervalos <- cut(Datos$age, breaks = c( min(Datos$age), 21, 25, max(Datos$age) ), labels = c('<= 21', '22-24', '>= 25' ))
Datos$age
```
 
```{r}
Datos$intervalos
```

* Crear una variable compuesta (Composite Variable) usando las variables corcub, sdmttoco, lnsscore y waisvocd de la siguiente manera:
    + Estandarizar las cuatro variables (media 0 y desviación estándar 1).
    + Sumar los cuatro valores estandarizados.
    

```{r}
Datos$Corcub <- scale(Datos$corcub)
print(round(mean(Datos$Corcub, na.rm = TRUE), 3) == 0)
print(round(sd(Datos$Corcub, na.rm = TRUE), 3 ) == 1)

Datos$Sdmttoco <- scale(Datos$sdmttoco)
print(round(mean(Datos$Sdmttoco , na.rm = TRUE), 3) == 0)
print(round(sd(Datos$Sdmttoco , na.rm = TRUE), 3 ) == 1)

Datos$Lnsscore <- scale(Datos$lnsscore)
print(round(mean(Datos$Lnsscore, na.rm = TRUE), 3) == 0)
print(round(sd(Datos$Lnsscore, na.rm = TRUE), 3 ) == 1)

Datos$Waisvocd <- scale(Datos$waisvocd)
print(round(mean(Datos$Waisvocd , na.rm = TRUE), 3) == 0)
print(round(sd(Datos$Waisvocd , na.rm = TRUE), 3 ) == 1)
```

Ahora creo la nueva variable CV (Composite Variable): REVISAR, NO SÉ SI ESTÁ CORRECTO

```{r}
Datos$CV <- Datos$Corcub + Datos$Sdmttoco + Datos$Lnsscore + Datos$Waisvocd
print(summary(Datos$CV))
print(mean(Datos$CV, na.rm = TRUE))
print(sd(Datos$CV, na.rm = TRUE))
```

* Media, mediana, desviación estándar y rango de la variable compuesta de cada grupo.

    + Media grupo <= 21:
```{r}
print(mean(Datos$CV[which(Datos$intervalos == '<= 21')], na.rm = TRUE))
```
    + Mediana grupo <= 21:
```{r}
print()
```
    + Desviación estándar grupo <= 21:
```{r}
print()
```    
    + Rango del grupo <= 21:
```{r}
print()
```   
    
    
        + Media grupo 22-24:
```{r}
print(mean(Datos$CV[which(Datos$intervalos == '22-24')], na.rm = TRUE))
```
    + Mediana grupo  22-24:
```{r}
print()
```
    + Desviación estándar grupo  22-24:
```{r}
print()
```    
    + Rango del grupo 22-24:
```{r}
print()
```   
    
    
        + Media grupo >= 25:
```{r}
print(mean(Datos$CV[which(Datos$intervalos == '>= 25')], na.rm = TRUE))
```
    + Mediana grupo >= 25:
```{r}
Datos$CV[which(Datos$Group == '>= 25')]
str(Datos)
```
    + Desviación estándar grupo >= 25:
```{r}
print()
```    
    + Rango del grupo >= 25:
```{r}
print()
```   
    
    
    
    
***

* Añadid el data frame creado como nueva tabla a la base de datos StudyENTE.mdb.

* Utilizad la funci ́on sqlQuery (del paquete RODBC) para extraer (solamente) las variables grupo de estudio y edad
(categorizada) de la nueva tabla de StudyENTE.mdb

* Representad la distribuci ́on condicionada de la variable edad por grupo de estudio mediante un gr ́afico de
mosaicos.

* Representad la distribuci ́on condicionada de la variable edad por grupo de estudio mediante una tabla de
contingencia usando la funci ́on CrossTable del paquete descr.

* Cerrad la conexi ́on a la base de datos StudyENTE.mdb.

* Exportad vuestro data frame a un fichero EXCEL de tal manera que el fichero EXCEL contenga una hoja por cada grupo de estudio con nombre igual al grupo de estudio. Las tres hojas del fichero ya no deben contener la variable group. Pod ́eis usar la funci ́on write.xlsx del paquete xlsx o la funci ́on write.xlsx del paquete openxlsx.






